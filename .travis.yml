language: go
go:
  - 1.14.7
services:
  - docker
  - postgresql
env:
  global:
    - DOCKER_USER=dinopuguh
    - MYCAP_DB_USER=postgres
    - MYCAP_DB_PASSWORD=postgres
    - MYCAP_DB_HOST=localhost
    - MYCAP_DB_NAME=mycap
    - MYCAP_DB_PORT=5432
    - secure: ggKqLcD5pRzOhkQKTx+Oeb8jFK6TlNgYJpNdEY8CA9O6H7EWyJ50hPJxVqz2rLjNQrIiVf0+XPA2+17cWizFPi9qdWcIXj6rJkbMYYLWChEXVki7crsstAssvdX+rfHgwAPSFJ4gIr6LFxh/9KUEv13V11ZReEg40K2UIRJd+WhQxXoaU3xJNEjbiLpTPDyxK3zLdbPLFBfuzC3HOONFubFr5LDy8uRVPMwEL9KzTWReSN+YDLY/BoVSWAS8z2hW4FvLoYU1irHFcvvEg1c/ysbwwrHf4/A/nDouK2DQU294h2bsX7Q9CCRS3HgcW+KaZaOsS1SI4Y48CT1uCPElLKG/zYJLDCeTEcu4B9yk+YSzpx+D+bY4sxV51Z/1j86a/j7Er4Atv8gfC0Uh5NnoOigno0RGqSUx4KuRoXl1yO2wR6ix2fqjDYa5ZFz55p/Lrx3xIVghRf3s+trelZRp+qvyiCFljURvtCkTZiGEeFVQQjDxdLp8dUkf7EKUX3PlUfNBddWqjg0hfRUSnI5y3OhxUUQKjXM1cUY4wXJQJoMwrN3+ePJsGdRNkFiSusskPufhE/vWpGOpbM4eewnsVTcMwSKMNQVx81O1W0JsieOnrRm0B+4ln7nuecwoO/owhYTkoWpKLAWX1na69STuLx+oUS5y8q8bL2Tn5VjEVVA=
    - secure: BNdiUkPhkto14CdG3Tjr0JoJv7IQNtdk68DCgAgSHnbqVzOW5lAlbG9hz3J/GkGvONzfzQHanLxpIPQhQhd0ETv6WDaOE5UwoHg6xoSHPF4m+Ifw3cUp+ksS0R7x9J+1Zd5iIk35aEClsqE/x1tFHkW+bq75ljRERt0mCX+nP0GWN96SZDgmOVBs8sN1xCUgpzDN3oUGDo4icsdZAKXTW8MgEQCmYzwd3Xds8IUMKpshf39shJLKV1EfNcNRCntlmJoWn2Et52OdMvYbgAd/xsPi4HxRlhOnxEAFS6J6BnP1y1/mLouRUHa8iFg6iu+jWJA6rxgh1GM+rDcVjChzPa8lcEbHymkf1WDqb4KEeCItEd9MhDl2JDL4eWaNws0B5n71AuRpRgUZdwFDsnKrmZpUJRvImLgozbBWZAv+MiGzNcqkS9r5mhRIfIGW+RNYTh8lN1GFO8QT9f8P4Q9aHeuscgUYJIi/LoSnrpC5N8fMNJtQgKsBTUzUQwK+/yGPneWrNTDghRVnC43IKLb+0RQCNjj//z0hjEbvRll9IpnVUeStHUBJVAW6E34Tv1MjLcW7+VQ3OAJK5w4I2wdbDGkRjhdkf9qYYX2O+YikwKsJug+OZizVppRWsQuxGPcLeiBLzmf4YzGIvfSCCXeHYJwV802iZJqxn+FIOKJPLsI=
    - secure: tMV7Hus9xudn1CM9wnCO2Tlt6CL0c8kypwz6jfnSfEvopWusLJdTr5zeoMgyr+ElJ4Gac/9Hsbm6J1e299uo6O3i86XMhxmp0RZXMShpNs5RgrJ3yoPG5N3/sROCXJ8lP3RaQ8/GDxrQ6rL0FBfSnBH3Jcg9PrV+pb28h7uhIqXP0ADRxQeOiCx1rkF1g74lt8KE8Jh/f5hXeBIB2scB6ZV5zBzvdBLDOZObxONRor6rRNJVNz2AKAixEfXgpniABZ3vtedfDnfsxUAHg0cgZOFZRaOc7XHEPAjAQwCKIOMCtm7itpdRENfJc0yQ7RfyuY9JKjGuqSX7a1pP7GBocLgo3bwBq80hQdJqpjeAOj2uqms3o5x9XOxMCb0X+v4TDRbfsKyXbjio7B+LZpXkVYMD7JrdndMq4hgO1bPUZREsbq1TeNayiTr57qCVOyNmXcdMTUvWOk8xizj8Sq7MfXAFOe1qjbTsKomSNz927qKCIC8PdhvAWhIQsmI24NmHhEeaEQVlHuFl2aIpM/gpKQlY5b7EtMbxfXYDiD0yLV5pPl4561Lf4RZcDtDr+f3irAR50QyYSb1R4hiRk7yRv6XsineTwYLOnKU7RJowXP/I5umnzKcqAyewaOv6RiD/m6/pTbDIxMG3+ACN/UC13BPpupQlNSGEvGuZcF+4M80=
    - secure: XZRkb30SF9CNLQkIqfchnsTmrqdtHL233RUui7p0ri6f2vme9JCXepc/jLNgNEgPJWxOcGq9KIb5RL6mzXdSYJuNoeeHXt0ZcC5LQIRYJ0xcj8+BZnG8VhdgVhaWPcmSpGf7OeeN5PM3/GuKjCRppIsCUc3qs9e7afbLIlQ7PLjw+B0Sxe76SlSFsfNAXVZ4o2yAnsz4ogZnFG8gccAk3p6OCvAYnBmQWczc8glIkPWf1h5hj4shCyoU6KsYiwnXD9LDaaMFO1tqAnUafp28NKkU6CxcoL58RpN/t2owk+h6aJqoKzW7XRVwfWWXEyUtlGgAH0vLqoDXM9jSfmgQ+m+eIk4Q7q4KOEZKfD84H2vfMulA7FHzSrWPMZLdPuNRf6otUckZ4L7QAhq7ojgZW5di+JYPGPo2SdSiQkdnsRp8KTf0RgTjgHLk96XZZXcjtjljp3MWtrLzFWo80ErMGo8Kn4gpDGHrZU2M6bciRgG9iiGuZZc6lAnfAERMcG8bainWr9KFvEy8NflTWr/d7q0EYTvA2j2D7vFZ0SLoMbjr/RTmXNwdxvi0jrV5USgbm5B0dXiI/T8tIhlan0hyHwqlD4Cef1rEqPxjB5cOy+2eKbsgfyZIKYxFb0k7VgdaL8uz/oSEJdGHMTkxmXChSTauvNN7r764dhnHPHL2R14=
    - secure: ikhHEm+xk+x4Azr6kFz+Ew8l6W/tVgCFSX2keGpH7NhjB8QGHwneCf5Ts9HsCFUwXaDQVf7Kmm+5BmzHQ4H41yhdkaxuECTJ/gT9jKDSVVHOKeKdOgzex03u8Lt3eBGrk5Nfn8gv3dPtBSyU12p70N25xrex+Uutp4c8kix+275GAwEErInJ+eiwPrOoysrnQchWMqGWAeorIs9RUQCTH/Y9fmPmdVm9kTYsQMO93s5OTvcviy9/Cq6vuB/Nxsgwz+BN6FpZzBAecJYt+Iq31Hy9h5GkapaFKQ8jgwtpI9ztm646yaUdJgOqxe4PeMtvnAnmnixZjXRg3uH/bQ7i8lwIeSGR9Gy0PuOkwjfPtRAFkzUsziZqH2hNXRhIYXDFsNMexLhxJPV8oPg4jQbU6pA83cOnSjhQIgovved0oFxB0/5JXKek1bHYbbk/qKuOhQro79HvOmiQwD83U16qSk7rKbXIlfRizLHxhWGX/xrdf2nyjWrKAVlM6BhgM9Q6xXNriA5M3gR77lCYQIMqg8IEUAjFmX+UO7vrnuxdlicxRFS4UhdVCClwL346ETiQ0HY/xmkwPFu4xSKGtISgp06PrHREOw+F/neSW2+aJvwmS5+5cCAe37LAZ2cQGvph393PWoacaDNox7B+YBVB4LXUZoHD3Vq2V1dQuS/stMc=
before_script:
  - psql -c 'create database mycap;' -U postgres
script:
  - scripts/cibuild.sh
after_success:
  - docker build -t mycap-backend .
  - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
  - docker tag mycap-backend $DOCKER_USER/mycap-backend:$TRAVIS_BUILD_NUMBER
  - docker push $DOCKER_USER/mycap-backend:$TRAVIS_BUILD_NUMBER
  - docker tag mycap-backend $DOCKER_USER/mycap-backend:latest
  - docker push $DOCKER_USER/mycap-backend:latest
  - docker login -u $HEROKU_USER -p $HEROKU_API_KEY registry.heroku.com
  - heroku container:push web -a mycap-staging
  - heroku container:release web -a mycap-staging
